var fs = require('fs'),
    url = require('url'),
    querystring = require('querystring'),
    formidable = require('formidable'),
    request = require('request'),
    util = require('util');

exports.photoUpload = function(req, res){
    
   /* var queryStr = url.parse(req.url).query,
        queryParam = querystring.parse(queryStr);
    console.log(queryParam);

    //fs.unlinkSync(BASE_DIR + '/static/picture/pictureTest.jpg');*/

    var form = new formidable.IncomingForm();
    form.parse(req, function(err, fields, files){
        //fs.writeFileSync(BASE_DIR + '/static/picture/pictureTest.jpg', files.image);

        /*request("http://127.0.0.1:1337/userMessage?loginaccount=" + queryParam.loginaccount, function(err, response, body){
            if(response.statusCode == 200){
                //console.log(body);
                     
                res.writeHead(200, {'Content-Type' : 'text/html'});
                res.write(body);
                res.end();
                //console.log("now we are in callback function!");
            }
        });
        return;  */
        //console.log(req);
        //console.log(fields);
        //console.log("-------------------------------------------------");
        //console.log(files);
        //console.log(queryParam.image);
        //res.writeHead(200, {'Content-Type' : 'text/plain'});
        //res.end(util.inspect({fields : fields, files : files}));
        fs.renameSync(files.image.path, BASE_DIR + '/static/picture/test.jpg');
        console.log("success!");

    });

    /*var postData = '';

    req.addListener('data', function(postDataChunk){
        postData += postDataChunk;
    });

    req.addListener('end', function(){
        var params = url.parse(postData);

        //console.log(postData);
        fs.writeFileSync('C:/Users/Administrator/Desktop/17542145384982/test.jpg', params);
        console.log('success!');
    });*/

}