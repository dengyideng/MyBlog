var fs = require('fs'),
    url = require('url'),
    querystring = require('querystring');

exports.blogExperts = function(req, res){
	/*var retHtml = fs.readFileSync(BASE_DIR + '/static/html/index.html');
	console.log("index has already returned!");

	res.writeHead(200, {'Content-Type' : 'text/html'});
    res.write(retHtml);
    res.end();*/
    var params = {"experts" : [{
        "account" : 0,
        "photo" : "",
        "nickName" : "",
        "city" : "",
        "blogsCount" : 0,
        "readCount" : 0,
        "job" : ""
    },{},{},{},{},{},{},{}],
        "login" : {
            "account" : 0,
            "nickName" : ""
        },
        "statusCode" : 0
    };

    var usersStr = fs.readFileSync(BASE_DIR + '/static/data/user.json');
    var users = JSON.parse(usersStr);
    var blogsStr = fs.readFileSync(BASE_DIR + '/static/data/blog.json');
    var blogs = JSON.parse(blogsStr);

    var blogMark, userMark, blogIndex, userIndex;
    var queryStr = url.parse(req.url).query,
        queryParam = querystring.parse(queryStr);

    if(queryParam.statuscode != null){
        params.statusCode = queryParam.statuscode*1;
    }


    for(var i = 0; i < 8; i ++){
        params.experts[i].account = users.users[i].account;
        params.experts[i].photo = users.users[i].photo;
        params.experts[i].nickName = users.users[i].nickName;
        params.experts[i].city = users.users[i].city;
        params.experts[i].blogsCount = users.users[i].blogsCount;
        params.experts[i].readCount = users.users[i].readCount;
        params.experts[i].job = users.users[i].job;
    }

    //添加login信息
    if(queryParam.loginaccount*1 != 0){
        for(var x in users.users){
            if(users.users[x].account == queryParam.loginaccount*1){
                params.login.account = users.users[x].account;
                params.login.nickName = users.users[x].nickName;
                break;
            }
        }
    }

    console.log("blogExperts has already returned!");
    console.log(params);
    res.render(BASE_DIR + '/static/template/blogExperts.jade', {"params" : params});
};