//用来传输静态文件
var fs = require('fs'),
    url = require('url'),
    querystring = require('querystring');

exports.dealWithStatic = function(req, res){
	var pathname = url.parse(req.url).pathname,
	    realPath;

	//var realPath = STATIC +'/image/' + paramObj[picName];
	//var realPath = BASE_DIR + '/static' + pathname;
    if(pathname == '/favicon.ico'){
    	realPath = BASE_DIR + '/static/icon/icons' + pathname;
    }else{
    	realPath = BASE_DIR + '/static' + pathname;
    }

	console.log(realPath);

	fs.exists(realPath, function(exists){

		if(!exists){
			res.writeHead(404, {'Content-Type' : 'text/plain'});
			//res.write("Source was not found in this server!");
            res.end();
            console.log('Source was not found in this server!');
		}else{
			fs.readFile(realPath, function(err, file){
				if(err){
					res.writeHead(500, {'Content-Type' : 'text/plain'});
					res.end(err);
					console.log("500 error!");
				}else{
                    var pointPosition = pathname.lastIndexOf('.'),
                        mimeString = pathname.substring(pointPosition + 1),
                        mimeType;

                    switch (mimeString){
                    	case 'css': 
                    	    mimeType = 'text/css';
                    	    break;
                    	case 'jpg':
                    	    mimeType = 'image/jpg';
                    	    break;
                    	case 'js':
                    	    mimeType = 'application/javascript';
                    	    break;
                    	default:
                    	    mimeType = 'text/plain';
                    }

					res.writeHead(200, {'Content-Type' : mimeType});
					res.write(file);
					res.end();
					console.log("200 OK!");
				}
			});
		}
	});
};